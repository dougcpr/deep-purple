import logging

from freedomrobotics.management import unregister_initd_service
from freedomrobotics.management import unregister_systemd_service
from freedomrobotics.helpers.system_commands import run_step
from freedomrobotics.management.register_systemd_service_base import install

if __name__ == "__main__":

    logging.basicConfig(level=logging.DEBUG)
    logging.getLogger("urllib3").setLevel(logging.WARNING)
    logger = logging.getLogger(__name__)

    pid1 = run_step("ps --no-headers -o comm 1",
                    "Checking if systemd is running",
                    "Systemd is not running as PID 1 so can not use it for service management.",
                    logger)

    if "systemd" not in pid1:
        raise Exception("Systemd is not running as pid 1 so can not register Freedom Robotics as a systemd service.")

    unregister_initd_service.unregister(logger)
    unregister_systemd_service.unregister(logger)

    install(logger)
